{% extends 'base.html' %}
{% block title %}Extrato - Finanças{% endblock %}
{% block content %}

<!-- ===================== FILTRO POR MÊS ===================== -->
<div class="card mb-3">
    <div class="card-body">
        <div class="row align-items-center">
            <div class="col-md-6">
                <h5 class="card-title mb-0">Período: {{ mes_atual }}</h5>
            </div>
            <div class="col-md-6">
                <form method="get" class="d-flex">
                    <select name="mes" class="form-select me-2" onchange="this.form.submit()">
                        <option value="">Mês Atual</option>
                        {% for mes in meses_disponiveis %}
                            <option value="{{ mes.valor }}" {% if mes.valor == mes_selecionado %}selected{% endif %}>
                                {{ mes.label }}
                            </option>
                        {% endfor %}
                    </select>
                    <a href="{% url 'index' %}" class="btn btn-outline-secondary">Hoje</a>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- ===================== RESUMO DO MÊS ===================== -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-white bg-success">
            <div class="card-body">
                <h6 class="card-title">Entradas (Mês)</h6>
                <h4 class="card-text">R$ {{ total_entradas }}</h4>
                <small>Total: R$ {{ total_entradas_geral }}</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-danger">
            <div class="card-body">
                <h6 class="card-title">Saídas (Mês)</h6>
                <h4 class="card-text">R$ {{ total_saidas }}</h4>
                <small>Total: R$ {{ total_saidas_geral }}</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white bg-info">
            <div class="card-body">
                <h6 class="card-title">Reservas (Mês)</h6>
                <h4 class="card-text">R$ {{ total_reservas }}</h4>
                <small>Total: R$ {{ total_reservas_geral }}</small>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card text-white {% if saldo >= 0 %}bg-primary{% else %}bg-warning{% endif %}">
            <div class="card-body">
                <h6 class="card-title">Saldo (Mês)</h6>
                <h4 class="card-text">R$ {{ saldo }}</h4>
                <small>Total Geral: R$ {{ saldo_geral }}</small>
            </div>
        </div>
    </div>
</div>

<!-- ===================== BOTÕES DE AÇÃO ===================== -->
<div class="d-grid gap-2 d-md-flex mb-3">
  <a href="{% url 'nova_entrada' %}" class="btn btn-success me-md-2">Nova Entrada</a>
  <a href="{% url 'nova_saida' %}" class="btn btn-danger me-md-2">Nova Saída</a>
  <a href="{% url 'nova_reserva' %}" class="btn btn-reserva">Nova Reserva</a>
</div>

<!-- ===================== ABAS ===================== -->
<ul class="nav nav-tabs mb-3">
  {% for tab in abas %}
    <li class="nav-item">
      <button class="nav-link {% if forloop.first %}active{% endif %}" data-bs-toggle="tab" data-bs-target="#{{ tab.id }}">{{ tab.label }}</button>
    </li>
  {% endfor %}
</ul>

<!-- ===================== CONTEÚDO DAS ABAS ===================== -->
<div class="tab-content">
  {% for tab in abas %}
    <div class="tab-pane fade {% if forloop.first %}show active{% endif %}" id="{{ tab.id }}">
      
      {% if tab.id == 'extrato' %}
        {% for item in extrato %}
          {% include 'partials/transacao_card.html' with item=item %}
        {% empty %}
          <p class="text-center text-muted">Nenhuma transação neste período.</p>
        {% endfor %}

      {% elif tab.id == 'entradas' %}
        {% for item in entradas %}
          {% include 'partials/transacao_card.html' with item=item %}
        {% empty %}
          <p class="text-center text-muted">Nenhuma entrada neste período.</p>
        {% endfor %}

      {% elif tab.id == 'saidas' %}
        {% for item in saidas %}
          {% include 'partials/transacao_card.html' with item=item %}
        {% empty %}
          <p class="text-center text-muted">Nenhuma saída neste período.</p>
        {% endfor %}

      {% elif tab.id == 'reservas' %}
        {% for reserva in reservas_list %}
          <div class="card mb-3">
            <div class="card-body">
              <h5 class="card-title">{{ reserva.nome }}</h5>
              <p class="card-text text-muted">{{ reserva.get_tipo_display }}</p>
              
              <div class="progress mb-2">
                <div class="progress-bar" style="width: {{ reserva.progresso }} %">
                  {{ reserva.progresso|floatformat:1 }}%
                </div>
              </div>
              
              <div class="d-flex justify-content-between">
                <span>R$ {{ reserva.valor_atual }} / R$ {{ reserva.valor_objetivo }}</span>
                <div>
                  <a href="{% url 'editar_reserva' reserva.pk %}" class="btn btn-sm btn-outline-secondary">Editar</a>
                  <a href="{% url 'deletar_reserva' reserva.pk %}" class="btn btn-sm btn-outline-danger">Excluir</a>
                </div>
              </div>
            </div>
          </div>
        {% empty %}
          <p class="text-center text-muted">Nenhuma reserva cadastrada.</p>
        {% endfor %}

      {% endif %}
      
    </div>
  {% endfor %}
</div>

<!-- ===================== BOTÕES FLUTUANTES ===================== -->
<div class="floating-buttons">
  <a href="{% url 'nova_reserva' %}" class="btn btn-reserva rounded-circle floating-btn" title="Nova Reserva" style="bottom: 150px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="white" viewBox="0 0 16 16">
      <path d="M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v13.5a.5.5 0 0 1-.777.416L8 13.101l-5.223 2.815A.5.5 0 0 1 2 15.5V2zm2-1a1 1 0 0 0-1 1v12.566l4.723-2.482a.5.5 0 0 1 .554 0L13 14.566V2a1 1 0 0 0-1-1H4z"/>
    </svg>
  </a>
  <a href="{% url 'nova_entrada' %}" class="btn btn-success rounded-circle floating-btn" title="Nova Entrada" style="bottom: 80px;">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="white" viewBox="0 0 16 16">
      <path d="M8 7v6m0-6V1m0 6H2m6 0h6" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
    </svg>
  </a>
  <a href="{% url 'nova_saida' %}" class="btn btn-danger rounded-circle floating-btn" title="Nova Saída">
    <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" fill="white" viewBox="0 0 16 16">
      <path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm4 4a.5.5 0 0 0-.374.832l4 4.5a.5.5 0 0 0 .748 0l4-4.5A.5.5 0 0 0 12 6H4z"/>
    </svg>
  </a>
</div>

{% endblock %}